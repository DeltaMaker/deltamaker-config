#
# Date: 10/14/2022
#
# Filename: printer-deltamaker-tmc2130.cfg
# Description: DeltaMaker config for MCU boards with TMC 2130 stepper drivers
#
# MCU Pin numbers are defined in a seperate board-specific config file, such as:
#	~/deltamaker-config/printer-deltamaker-printhat-v1.pins
#		-or-
#	~/deltamaker-config/printer-deltamaker-einsy-rambo.pins
#

[mcu]
#serial: /dev/ttyAMA0
restart_method: command

[mcu rpi]
serial: /tmp/klipper_host_mcu

[endstop_phase]

##### DELTAMAKER KINEMATICS #####
[printer]
kinematics: delta
max_velocity: 500
max_accel: 5000
max_accel_to_decel: 2500
max_z_velocity: 150
minimum_z_position=-15
square_corner_velocity: 5


##### BED MESH LEVELING #####
[bed_mesh]
speed: 150
horizontal_move_z: 8
#round_probe_count: 7
#relative_reference_index: 14
##round_probe_count: 5
##relative_reference_index: 6
#round_probe_count: 3
#relative_reference_index: 2
fade_start: 1.0
fade_end: 10.0
split_delta_z: .025
move_check_distance: 5.0
mesh_pps: 3,3
algorithm: bicubic
bicubic_tension: .2

##### RASPBERRY PI COOLING FAN #####
[temperature_fan rpi_fan]
target_temp: 46
kick_start_time: 0.8
#shutdown_speed: 0
off_below: 0.1
max_power: 1.0
#fan_speed: 0.6
sensor_type: temperature_host
control: pid
min_temp: -40
max_temp: 85
#max_delta: 5.0
pid_kp: 1.0
pid_ki: 0.5
pid_kd: 2.0
min_speed: 0.1
max_speed: 0.6

##### SKYLIGHT NEOPIXEL LED STRIP #####
[neopixel status_leds]
color_order: GRB
initial_RED: 0.3
initial_GREEN: 0.3
initial_BLUE: 0.3

##### STEPPER MOTOR A #####
[stepper_a]
microsteps: 16
rotation_distance: 40
#step_distance: .01250
homing_speed: 60
homing_retract_dist: 4
homing_retract_dist: 4
homing_retract_speed: 30
second_homing_speed: 10


[tmc2130 stepper_a]
run_current: 0.580
#run_current: 0.75
#hold_current: 0.500
#stealthchop_threshold: 999999

##### STEPPER MOTOR B #####
[stepper_b]
microsteps: 16
rotation_distance: 40
#run_current: 0.75
#hold_current: 0.500
#step_distance: .01250

[tmc2130 stepper_b]
run_current: 0.5
hold_current: 0.5
stealthchop_threshold: 50

##### STEPPER MOTOR C #####
[stepper_c]
microsteps: 16
rotation_distance: 40
#step_distance: .01250

[tmc2130 stepper_c]
run_current: 0.5
hold_current: 0.5
stealthchop_threshold: 50

##### EXTRUDER MOTOR/HEATER/SENSOR #####
[extruder]
microsteps: 16
rotation_distance: 33.500
#step_distance: .01036725
nozzle_diameter: 0.50
filament_diameter: 1.750
#max_extrude_only_accel: 1500
sensor_type: EPCOS 100K B57560G104F
#min_temp: 5
max_temp: 260
#min_extrude_temp: 170
##NO HOTEND
min_temp: -100
min_extrude_temp: -100

[tmc2130 extruder]
run_current: 0.5
hold_current: 0.5
stealthchop_threshold: 50

##### EXTRUDER FAN #####
[heater_fan extruder_fan]
heater: extruder
heater_temp: 50.0
fan_speed: 1.0


##### TOUCH PROBE #####
[probe]
speed: 4.0
lift_speed: 25.0
samples: 2
sample_retract_dist: 2.0
samples_result: average
samples_tolerance: 0.05
samples_tolerance_retries: 10
activate_gcode:
    PROBE_POWER_ON
deactivate_gcode:
    PROBE_POWER_OFF

[gcode_macro PROBE_POWER_ON]
gcode:
   SET_PIN PIN=probe_power_pin VALUE=1
   G4 P200
[gcode_macro PROBE_POWER_OFF]
gcode:
   SET_PIN PIN=probe_power_pin VALUE=0



